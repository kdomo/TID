# 04.데이터 조작 프로시저 최적화 (⭐)

- 쿼리 성능 개선(튜닝)
    - 최소의 시간으로 원하는 결과를 얻도록 프로시저를 수정하는 작업
- 쿼리 성능 개선 절차
    - 문제있는 SQL 식별 → 옵티마이저 통계 확인 → SQL 문 재구성 → 인덱스 재구성 → 실행계획  유지관리

- 옵티마이저(Optimizer) : SQL 가장 효율적으로 수행되도록 최적의 경로를 찾아 주는 모듈
- 옵티마이저의 유형 비교

| 비교 | 규칙 기반 옵티마이저(RBO) | 비용 기반 옵티마이저(CBO) |
| --- | --- | --- |
| 개념 | 통계 정보가 없는 상태에서 사전 등록된 규칙에 따라 질의 실행 계획을 선택하는 옵티마이저 | 통계 정보로부터 모든 접근 경로를 고려한 질의실행계획을 선택하는 옵티마이저 |
| 핵심 | 규칙(우선 순위) 기반 | 비용(수행 시간) 기반 |
| 평가 기준 | 인덱스 구조, 연산자, 조건절 형태 등 | 레코드 개수, 블록 개수, 평균 행 길이, 컬럼 값의 수, 컬럼 값 분포, 인덱스 높이, 클러스터링 팩터 등 |
| 정렬 | 사용자가 원하는 처리경로로 유도하기가 쉬움 | 옵티마이저의 이해도가 낮아도 성능보장 가능(기본 설정) |

- 힌트(Hint)
    - SQL 성능 개선의 핵심 부분으로 옵티마이저의 실행 계획을 원하는 대로 변경할 수 있게 한다.
    - 옵티마이저가 항상 최선의 실행 계획을 수립할 수 없어 명시적인 힌트를 통해 실행계획을 변경한다.
- 힌트 사용예시

```sql
SELECT /*+ RULE */ Ename, SAL
FROM EMP
 WHERE EMPNO > 9000;

-- 비용기반 옵티마이저에서 규칙기반 옵티마이저 모드로 변경 수행
```

- 주요 옵티마이저 힌트
  | 힌트 | 설명 |
  | --- | --- |
  | /*+ RULE */ | 규칙 기반 접근 방식을 사용하도록 지정 |
  | /*+ CHOOSE */ | 오라클 옵티마이저 디폴트 값에 따름 |
  | /*+ INDEX(테이블명 인덱스명) */ | 지정된 인덱스를 강제적으로 사용하도록 지정 |
  | /*+ USE_HASH(테이블명) */ | 지정된 테이블들의 조인이 Hash Join 형식으로 일어나도록 유도 |
  | /*+ USE_MERGE(테이블명) */ | 지정된 테이블들의 조인이 Sort Merge 형식으로 일어나도록 유도 |
  | /*+ USE_NL(테이블명) */ | 지정된 테이블들의 조인이 Nested Loop 형식으로 일어나도록 유도 |